# JBNU 2025-1 Mobile Programming
Mobile Prgramming with Kotlin(Android Studio), Python 3

이 리포지토리는 전북대학교 2025학년도 1학기 모바일프로그래밍 프로젝트 진행상황을 기록한 리포지토리입니다.
---
## 프로젝트 요약
### 프로젝트명: BIS 기반 도착예측 및 대중교통 길찾기 개선 앱
#### 프로젝트 목표
> 1. 대한민국 버스 시스템 한계로 인한 버스의 정시성 부족 문제를 간접적으로 해결
> 2. 기존 네이버/카카오지도 앱보다 더 정확한 대중교통 길찾기 AI와 유저 맞춤형 예측을 제공
> 3. 딥러닝 모델 기반의 도착 시간 예측 + 실시간 알림 + 사용자 피드백 반영

### 전체 시스템 구조
#### 데이터 수집
> 1. 전주시 BIS API 활용: 정류장/노선 정보, 실시간 운행정보, 배차간격 등 조사
> 2. 날씨 API: 시간/위치 기반 날씨 정보 수집 (전주시의 경우 덕진구/완산구 둘로만 나눌 예정)
> 3. 교통 흐름 데이터: 전주시교통정보센터 비공식 API 기반
> PostgreSQL을 활용하여 데이터베이스를 구성하고, 위에서 모은 데이터를 기반으로 전처리 - 학습 예정.
#### 데이터 전처리 및 통합
> 정류장 ID, 노선 번호, 요일(평일/주말/공휴일), 버스 배차시간, 실제 정류장 도착 시간, 날씨, 교통혼잡도 등을 정규화하여 테이블 생성
#### 모델 설계 및 학습
> AI모델 예측 목표 : 정류장 A에, W요일 X시 Y분 Z날씨일 때 출발한 B번 버스가 실제로 언제 도착하는가?
> 사용이 예상되는 AI 기술
> 1. 데이터 기반 1차 추론: 회귀 기반 MLP, XGBoost
> 2. 보정 방식: 단순 선형 보간, LSTM 기반 시계열 지연 패턴 학습
> 3. 2차 추론: 실시간 피드백 기반 재보정 알고리즘
> 4. Pytorch기반 Continual Learning (ex. Experience Replay)
> 5. 보조 분석: k-NN 기반 유사 노선/날씨 탐색 후 평균 지연값 활용 가능
#### 백엔드 (서버/AI)
> 1. Python + Flask
> 2. 모델 서버와의 통신
> 3. DB 연동 (PostgreSQL)
> 4. 알림 시스템 처리
#### 프론트엔드 (Android/iOS(차후))
> 1. 출발/도착 정류장 입력 (또는 출발/도착지 입력으로 도보까지 계산)
> 2. 예상 도착시간 출력
> 3. (선택) 사용자 피드백 입력: 실제로 버스가 언제 도착했는지
> 4. 알림 기능 포함 (슬슬 지금쯤 나가야 한다.)

### 세부 기능 계획
1. 실시간 위치 확인: GPS와 API를 통한 실시간 위치 받아오기 - requests, BIS API
2. 도착 예측: DB 기반 도착시간을 예측 - PyTorch, 회귀모델
3. 사용자 피드백 수집: 실제 도착시간 입력 - PostgreSQL (DB에 insert하는 방식...)
4. 사용자 알림: 출발해야 하는 시간 알림 등
5. 대체경로 추천: 지연 시 다른 노선 제안 - 강화학습 / 데이크스트라

#### 노트
1. 고령자/시각장애인 배려로 음성-진동 기반 알링 기능을 넣어도 될듯?
2. 실제 도착시간을 입력하는 시스템을 "실시간 BIS로 정보를 수신하다가 버스가 목표 정류장에 도착했다고 판단되는 시간에 알림으로 보냄"

---
## 프로젝트 진행 상황
---
### 2025-04-15
#### 진행 상황 (프로젝트 리셋)
 - BIS 개선 프로젝트
 - 개선된 대중교통 길찾기 어플리케이션
#### 노트
 - 기획 점검
---
### 2025-04-16
#### 진행 상황
 - 작업용 PC와 학습용 서버를 구분하여 시스템을 구축함.
 - 개인 서버를 처음으로 만들어서 직접 headless로 구동, ssh로 접근하여 작업해봄. 신기한 경험.
#### 노트
---
### 2025-04-19
#### 진행 상황
 - 전주시 BIS API 신청 후 Service Key 수령.
 - 테스트해보았으나 관리를 안 하는지 XML 404, 001 응답 없음 (...?)
 - 전주시 BIS 홈피로 들어와서 비공식 API를 뜯어보기로 결정.
 - API 분석으로 데이터 받아보기 성공.
 - 비공식 API를 하나하나 뜯어보며 분석, 전체 노선 정보와 각 노선별 전체 정류장 정보 얻어옴.
 - 해당 정보를 기반으로 정적 데이터 정제 시작.
 - 새로운 프로젝트 디렉토리 구조 정립.
 - 버스 노선 리스트 추출
 - 노선별 부노선 리스트 추출
 - 각 노선별 정차 정류장 리스트 추출
 - 버스가 진행하는 노선별 도로상 특정 지점의 위치를 추출. (이걸로 교통흐름도 추적해서 변수로 넣을 수 있을듯?)
 - 각 노선별 출발 시간표 추출
 - 각 정류장별 통과 노선 정리
 
#### 노트
 - 비공식 API이기 때문에 우선 개인적으로 개발 이후, 배포 전 전주시에 문의를 해보도록 하자.

---
### 2025-04-20
#### 진행 상황
 - 도로교통정보 관련 API 찾음, 여기서 도로 LAT/LONG별로 ID와 GRADE(교통혼잡도)를 부여하는것으로 추정.
 - 해당 도로교통정보를 우선 ID, LAT, LONG 순으로 정렬 후 static화.
 - 기존 노선별 경로 Vertex를 도로교통정보에서 따온 ID별 Vertex와 매핑, processed에 추가.
 - 추후 모델 학습을 위해 수집해야하는 실시간 정보
 >  + A시B분에 출발한 C노선이 모든 정류장에 도착하는 실제 시간 기록 ~ Z초 간격으로 기록
 >  + 전주시 모든 도로 VERTEX에 대한 실시간 교통정보 기록 ~ Z초 간격으로 기록
 >  + 전주시 모든 도로 VERTEX에 대한 실시간 기상상태(강우(설)/기온) 기록 ~ 30분-1시간 간격으로 기록
 >  + 전주시 모든 도로 VERTEX에 대한 예측 기상정보 기록 ~ 최대 3일까지 기록
 - 공공데이터포털에서 기상청 초단기예측정보API를 신청, 매 30분마다 실시간 기상정보 수집하는 스크립트 완성.
 - 이었는데, 모든 도로 VERTEX를 기준으로 하니까 효율이 너무 떨어지지 않을까 하긴 하다. 도로별 SUB는 무시하고, 도로 하나당 1개씩 날씨를 뽑아보기로 함.
 - 사실 도로당 뽑아도 좀 의미가 있을까 싶긴 하다. 그래도 0번 SUB를 기준으로 추출 후 나머지 SUB에 대해선 0번 데이터를 복사해서 사용하도록 세팅.
 - 이었는데, 이마저도 중복 데이터가 엄청 많았다. 중복 데이터 제거를 위해 모든 도로 VERTEX(821개) 기준으로 실시간 날씨 정보를 뽑아옴.
 - 이후 "똑같은 정보를 포함하는 지점들끼리의 집합"을 생성. = 같은 기상이 보고되는 하나의 지역이라고 판단.
 - 이 집합의 대표자만 API를 통해 데이터를 받아온 뒤, 저장한다.
 - 이러면 특정 지점의 날씨를 필요로 할 때는 자신이 속해있는 집합 대표자의 정보만 가져오면 끝. 기존 821개->대략 7~8개로 저장공간 효율 1/100이 될듯.
 - 에서, 다시 날씨 정보에서 nx, ny(지역구) 기반으로 매핑. 이게 제일 정확할듯?
 - 이제 버스 실시간 위치 수집 스크립트 작성 시작.
 - 목표 : 각 요일별 매일 (평일/토요일/일요일+공휴일) 특정 시간대에 출발하는 버스를 매 30초마다 추적.
 - 30초마다 기록되는 실시간 위경도 위치와, 다음 정류장에 도착하는 시간을 하나하나 다 저장할 예정.
 - 해당 실시간 RAW 데이터는 raw/dynamicInfo/realtime_bus/{STDID}/ 아래에 YYYYmmDD_HHMM.json 형태로 저장될 예정. (YYYYmmDD_HHMM에 출발한 STDID 버스)
 - 매 30초마다 모든 노선 (분선 포함 451개)을 전부 감시하기엔 심한 리소스 낭비가 예상됨.
 - 그리고 현재 존재하는 실시간 버스 감시 API의 기능적 한계로 실제 이동중인 버스가 없을 땐 아무것도 반환하지 않음.
 - 따라서 현재 이미 정리해준 timetable을 caching이 가능한 형태로 변환.
 - 평일/토요일/일요일+공휴일별로 json파일을 따로 만들고, 특정 시간대에 출발하는 버스들을 감시 시작할 수 있도록 설정.
 - 감시가 시작되면, 포착된 버스의 번호판 정보 (PLATE_NO)를 기준으로 구분, 해당 버스의 모든 로그를 종점까지 추적.
 - STDID는 분선도 포함이므로, 중간기착지인경우도 걱정 없이 수집 가능.
 - 30초 단위 실시간 위치와, 특정 정류장에 최초로 도착하는 시간을 기록, data/raw/dynamicInfo/realtime_bus/ 아래에 STDID별로 기록 예정.
 - 10초 단위로 줄였고, 실시간 버스 추적이 일단은 되는 것으로 확인. (trackSingleBus.py)
 - 해당 파일을 스케줄러를 통해 특정 시간이 되면 특정 버스 추적을 실시하는 방향으로 자동으로 가동시킬 예정.
 - Python의 APScheduler를 사용해 "특정 요일 구분"의 미리 매핑해둔 시간대마다, 출발하는 버스들을 대상으로 10초간격 수집 계획.
#### 노트
 - 일단은... 순조롭다. 데이터만 긁어두면, 5월 초부터 모델 학습 들어가면 될 듯 하다.
 - 처음으로 그저 활용하는게 아닌 직접 모델링하는 AI라 설레는 느낌.

---
### 2025-04-21
#### 진행 상황
 - 드디어... 자동화 시작. runAll.py 제작 완료. 서버로 이식 예정.
 - 이식은 성공, 스케쥴러도 이상 없이 동작. 실제로 데이터 수집에 이상이 없는지는 내일 아침 돼봐야 알 듯.
 - 아침에 왔을 때 전혀 이상한 방향으로 동작하고, 호출도 안되고 수난이었다.
 - 경로 설정 등 그거 스케줄러와 모듈 호출의 문제였지 다행히 기능적인 이상은 아니었다.
 - 15시 기준 버스 로깅 등 여러가지 예외처리를 동반한 데이터 수집은 가능해졌으나, 버스의 상세 위치는 전부 NULL로 뜬다.
 - 이 NULL을 조금 해결해줘야 할 듯. 매번 긁어올 때마다 정확한 위치를 측정할 생각이다. 그래봤자 전주라 4000개다.